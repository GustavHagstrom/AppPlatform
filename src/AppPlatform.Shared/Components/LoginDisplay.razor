@using Microsoft.AspNetCore.Antiforgery
﻿@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Identity
@using AppPlatform.Core.Data


<AuthorizeView>
    <Authorized>
        
        <MudFab StartIcon="@Icons.Material.Sharp.Person" IconSize="Size.Medium" Size="Size.Small" OnClick="ToggltPopover" />

        <MudPopover Open="PopOverIsVisible" AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
            <MudText Typo="Typo.subtitle2" Style="color: var(--mud-palette-text-primary);">@context.User.Identity?.Name</MudText>
                <MudButton Href="/MicrosoftIdentity/Account/SignOut" OnClick="ToggltPopover" Class="px-4 mr-n2" Style="height: 100%;" Variant="Variant.Text" Color="Color.Inherit" StartIcon="@Icons.Material.Sharp.Logout">@Localizer["Logga ut"]</MudButton>
        </MudPopover>

        <MudOverlay Visible="PopOverIsVisible" LockScroll="true" OnClick="ToggltPopover" />

    </Authorized>
    <NotAuthorized>
            <MudButton Href="/MicrosoftIdentity/Account/SignIn" Class="px-4 mr-n2" Style="height: 100%;" Variant="Variant.Text" 
                       Color="Color.Inherit" StartIcon="@Icons.Material.Sharp.Login">@Localizer["Logga in"]</MudButton>
    </NotAuthorized>
</AuthorizeView>

    @code{
    [Inject] public required IStringLocalizer<LoginDisplay> Localizer { get; set; }

    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    private bool PopOverIsVisible { get; set; } = false;

    void ToggltPopover()
    {
        PopOverIsVisible = !PopOverIsVisible;
    }

    public static string GetInitials(string? name)
    {
        if (name is null) return string.Empty;
        var names = name.Split(" ");
        var initials = string.Empty;
        foreach (var item in names)
        {
            initials += item.First();
        }
        return initials;
    }
}
