@page "/Settings/UserAccess"
@layout SettingsLayout
@inject IStringLocalizer<UserAccessPage> Localizer


<SettingsPageBase>
    <SettingsSection Title="@Localizer["Användare"]" LoadDataAsync="LoadDataAsync">
        <MudList Clickable="true" Style="min-height: 300px;">
            @foreach (var user in UsersIterator)
            {
                <MudListItem OnClick="() => EditUserAccess(user)">
                    <UserAvatar User="user"/>
                </MudListItem>
            }
        </MudList>
    </SettingsSection>
</SettingsPageBase>



@inject IMicrosoftGraphUserAccess MicrosoftGraphUserAccess
@inject NavigationManager NavigationManager

@code{
    UserWithPhoto? SelectedUser { get; set; }
    List<UserWithPhoto> Users { get; set; } = new();
    IEnumerable<UserWithPhoto> UsersIterator => Users.OrderBy(x => x.User.DisplayName);

    async Task LoadDataAsync()
    {
        Users.Clear();
        Users.AddRange(await MicrosoftGraphUserAccess.GetUsersWithPhotoAsync());
        StateHasChanged();
    }
    void EditUserAccess(UserWithPhoto user)
    {
        NavigationManager.NavigateTo($"{Constants.ModuleRoutes.UserAccessSettings}/{user.User.Id}");
    }
}