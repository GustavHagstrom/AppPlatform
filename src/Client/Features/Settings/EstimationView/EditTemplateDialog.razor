@using Client.Shared.EstimationViewTemplate.Models;
@using Client.Shared.EstimationViewTemplate.Services;

<MudDialog>

    <DialogContent>
        
        <MudForm @ref="Form" Model="Template" Class="relative">

            <MudGrid Spacing="1" Justify="Justify.FlexStart" Class="pa-4">

                <MudItem xs="12" sm="12" md="6">
                    <MudText Typo="Typo.subtitle2" Style="color: var(--mud-palette-text-primary)">@Localizer["Namn"]</MudText>
                    <MudTextField T="string" Margin="Margin.Dense" Variant="Variant.Outlined" @bind-Value="Template.Name" />
                </MudItem>

            </MudGrid>

        </MudForm>
        
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Success" OnClick="Submit">Ok</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [Inject] public required IStringLocalizer<EditTemplateDialog> Localizer { get; set; }
    [Inject] public required IEstimationViewTemplateServices TemplateService { get; set; }
    [CascadingParameter] public required MudDialogInstance MudDialog { get; set; }
    [Parameter] public ViewTemplate Template { get; set; } = new() { Name = string.Empty };
    [Parameter] public Guid? IdToLoadFrom { get; set; } = null;

    public string TemplateParameterName => nameof(Template);
    public string IdToLoadFromParameterName => nameof(IdToLoadFrom);

    MudForm? Form;
    bool IsLoading = false;

    void SetIsLoading(bool isLoading)
    {
        IsLoading = isLoading;
        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {
        if(IdToLoadFrom is not null)
        {
            try
            {
                SetIsLoading(true);
                Template = await TemplateService.GetAsync(IdToLoadFrom.Value);
            }
            catch (Exception)
            {
                //Handle exception
                throw;
            }
            finally
            {
                SetIsLoading(false);
            }            
        }

    }

    void Submit()
    {
        Form?.Validate();
        if(Form?.IsValid == true)
        {
            MudDialog.Close(DialogResult.Ok(true));
        }
        
    }
}