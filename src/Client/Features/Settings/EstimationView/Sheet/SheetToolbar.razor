@using Client.Shared.EstimationViewTemplate.Models.SectionModels;


<SectionToolbar IsActive="IsActive">
    <div class="d-flex gap-1 mx-auto" style="padding-bottom: 2px;">

        <CellFormatEditor Format="SelectedColumn?.CellFormat" StateChangeRequest="StateChangeRequest"/>

        <div class="d-flex flex-column justify-end">

            <input placeholder="@Localizer["Bredd"]" class="pa-1" style="border: 1px; border-style: solid; width: 50px; height: calc(50% - 2px);" value="@SelectedColumn?.WidthPercent" @onchange="WidthInputChanged" disabled="@(SelectedColumn is null)" />
        </div>

        <div class="d-flex gap-1 flex-column justify-end">
            <MudButton Class="pa-1" Variant="Variant.Filled" Style="min-width: 0px; height: 50%;" Color="Color.Error" Disabled="SelectedColumn is null" OnClick="DeleteColumn">
                <MudIcon Icon="@Icons.Material.Sharp.Delete" Size="Size.Small" />
            </MudButton>
            <MudButton Class="pa-1" Variant="Variant.Filled" Style="min-width: 0px;  height: 50%;" Color="Color.Success" OnClick="AddColumn">
                <MudIcon Icon="@Icons.Material.Sharp.Add" Size="Size.Small" />
            </MudButton>
        </div>
        
    </div>
    
</SectionToolbar>

@code {
    [Inject] public required IStringLocalizer<SheetToolbar> Localizer { get; set; }
    [Inject] public required IDialogService DialogService { get; set; }

    [Parameter, EditorRequired] public bool IsActive { get; set; }
    [Parameter, EditorRequired] public SheetColumn? SelectedColumn { get; set; }
    [Parameter, EditorRequired] public required SheetSection Section { get; set; }
    [Parameter, EditorRequired] public EventCallback StateChangeRequest { get; set; }

    void WidthInputChanged(ChangeEventArgs args)
    {
        if (SelectedColumn is not null && args.Value is not null)
        {
            int.TryParse(args.Value as string, out int result);
            SelectedColumn.WidthPercent = result;
            StateChangeRequest.InvokeAsync();
        }
    }
    void AddColumn()
    {
        Section.Columns.Add(new SheetColumn { WidthPercent = 10 });
        StateChangeRequest.InvokeAsync();
    }
    async Task DeleteColumn()
    {
        if(SelectedColumn is not null)
        {
            var parameters = new DialogParameters<YesNoDialog>();
            parameters.Add(x => x.Info, Localizer["Vill du ta bort kolumnen?"]);

            var dialog = await DialogService.ShowAsync<YesNoDialog>(Localizer["Ta bort"], parameters);
            var result = await dialog.Result;
            if (!result.Canceled)
            {
                Section.Columns.Remove(SelectedColumn);
                await StateChangeRequest.InvokeAsync();
            }
        }
    }
}
