@page "/settings/organization/invite"
@using System.ComponentModel.DataAnnotations
@inject IStringLocalizer<InvitationPage> Localizer
@inject IInvitationService InvitationService
@inject IJSRuntime JSRuntime
@inject AuthenticationStateProvider AuthProvider

<SettingsPage Title="@Localizer["Bjud in till organisation"]">
    <MudForm @ref="Form">
        <MudTextField T="string" @bind-Value="email" Label="Email" Validation="@(new EmailAddressAttribute() {ErrorMessage = Localizer["Email är inte giltig"]})" />
    </MudForm>
    <MudButton OnClick="SubmitAsync" Variant="Variant.Filled" Color="Color.Primary">@Localizer["Skicka"]</MudButton>
</SettingsPage>


    @code {
    string email { get; set; } = string.Empty;
    MudForm? Form { get; set; }
    protected override void OnInitialized()
    {
        base.OnInitialized();
    }
    async Task SubmitAsync()
    {
        if (Form is null)
        {
            return;
        }
        await Form.Validate();
        if (!Form.IsValid)
        {
            return;
        }
        var state = await AuthProvider.GetAuthenticationStateAsync();

        await InvitationService.Create(state.User, email);
        //TODO: Send email
        //TODO: Show success message
        await JSRuntime.InvokeVoidAsync("history.back");

    }
}
