@using SharedLibrary.Constants;
@inherits LayoutComponentBase

<MudThemeProvider Theme="CustomThemes.PlatformStandard" @bind-IsDarkMode="IsDarkMode" DefaultScrollbar="false" />
<MudDialogProvider />
<MudSnackbarProvider />

<PageTitle>@($"{CommonAppConstants.ApplicationName} {CommonAppConstants.ApplicationVersion}")</PageTitle>

<CascadingValue Name="DarkModeAction" Value="SetDarkMode">

    <MudLayout Style="height: 100vh">
        <MudAppBar Elevation="3" Dense="true" DisableGutters="true" Class="px-2">
            <MudIcon Icon="@CustomIcons.BidconHub" Color="Color.Primary" Class="mr-2"  Size="Size.Large"/>
            <MudText Typo="Typo.h5" Class="ml-0 pr-4">@CommonAppConstants.ApplicationName</MudText>
            <MudSpacer />
            <LoginDisplay />
        </MudAppBar>
        
        <MudDrawer Open="false" ClipMode="DrawerClipMode.Always" DisableOverlay="true" Variant="DrawerVariant.Mini" Elevation="5">
            <MudNavMenu Color="Color.Primary" Dense="false">
                <MudNavLink Match="NavLinkMatch.All" Icon="@Icons.Material.Sharp.Dashboard" Href="@ApplicationRoutes.Dashboard" />
                <MudNavLink Match="NavLinkMatch.Prefix" Icon="@CustomIcons.BidconIcon" Href="@ApplicationRoutes.Import" />
            </MudNavMenu>

            <MudSpacer />

            <MudNavMenu Color="Color.Primary" Dense="false">
                    <MudNavLink Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Sharp.Settings" Href="@ApplicationRoutes.Settings" />
            </MudNavMenu>
        </MudDrawer>

        <MudMainContent Style="height: 100%">
            @Body
        </MudMainContent>

    </MudLayout>
    
</CascadingValue>

@code {
    [Inject] public required IStringLocalizer<MainLayout> Localizer { get; set; }
    [Inject] public required StyleService StyleService { get; set; }
    [Inject] public required Server.Services.Settings.IDarkModeService DarkModeService { get; set; }
    [CascadingParameter] HttpContext? HttpContext { get; set; }

    bool IsDarkMode { get; set; } = false;
    MudTheme Theme { get; set; } = CustomThemes.PlatformStandard;

    protected override async Task OnInitializedAsync()
    {
        var usr = HttpContext?.User;
        // var isDarkMode = await DarkModeService.GetUserDarkModeSettingAsync();
        // SetDarkMode(isDarkMode);
    }

    void SetDarkMode(bool isDarkMode)
    {
        IsDarkMode = isDarkMode;
        StateHasChanged();
    }

}